<link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.7.4/dist/semantic.min.css">
<script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.7.4/dist/semantic.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<style>
  .header {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    height: 50px;
    z-index: 10000;
    background-color: white;
  }
</style>
<div id="bg" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;" />
<h1 style="font-family: 'Roboto Mono', monospace; text-align: center; color: white; font-size: 5em;" id="title"
  contenteditable="true">Spring Hack Day Presentations</h1>
<h1 style="font-family: 'Roboto Mono', monospace; text-align: center; color: white; font-size: 3em;" id="subtitle"
  contenteditable="true"><i>Optional Subtitle not available</i></h1>
<h2 style="font-family: 'Roboto Mono', monospace; text-align: center; color: white; font-size: 2em;"
  contenteditable="true">Starting at <span id="timer">2019-04-05T16:00:00.000+0200</span></h2>
<h3 style="font-family: 'Roboto Mono', monospace; text-align: center; color: white; font-size: 2em; cursor: pointer;"><a
    hfref="#" onclick="submitForm()">Go!</a></h3>




<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/97/three.min.js">
</script>
<script src="https://www.vantajs.com/dist/vanta.net.min.js"></script>
<script>
  VANTA.NET({
    el: "#bg",
    color: 0x3fa4ff
  })
</script>


<script>
  const config = JSON.parse(localStorage.getItem('countdownConfig') || `{"title":"Title","subtitle":"Subtitle","time":"2019-04-05T16:00:00.000+0200","effect":"net"}`);


  function loadVisuals(effect) {
    // Setup Page
    var  visualSource = effect + '/index.js';
    var script = document.createElement('script');
    script.onload = function () {
      window.createMarkup(true);

      document.body.innerHTML += `
      <div class="header">
      <div class="ui grid">
          <div class="four wide column">


        Effect:
      <select onchange="loadNewVisuals()" class="ui dropdown" id="effect">
          <option>Effect</option>
          <option value="net" id="net">net</option>
          <option value="birds" id="birds">birds</option>
          <option value="camunda" id="camunda">camunda</option>
      </select>
    </div>

    <div class="four wide column">
      <div class="ui calendar" id="calendar">
    <div class="ui input left icon">
      <i class="calendar icon"></i>
      <input id="calendarInput" type="text" placeholder="Start Date">
      </div>
    </div>

      </div>

      <div class="four wide column">
          <button class="ui button" onclick="submitForm()">
            Go
          </button>

      </div>
      </div>
    `;
      $('#calendar')
        .calendar()
      ;
      console.log(document.getElementById(effect));
      document.getElementById(effect).selected = 'selected';

      //do stuff with the script
      if(title) {
      title.textContent = config.title;
      title.contentEditable = true;
      }
      if(subtitle)
      {
        subtitle.textContent = config.subtitle;
        subtitle.contentEditable = true;
      }
      function convertRemaining(milliseconds) {
        const minutes = Math.floor(milliseconds / 60 / 1000);
        const seconds = Math.floor((milliseconds / 1000) % 60);
        const ms = Math.floor((milliseconds % 1000) / 10);
        return leftPad(minutes) + ":" + leftPad(seconds);
        // if (minutes) {
        // } else {
        //   return leftPad(seconds) + ":" + leftPad(ms);
        // }
      }
      function leftPad(number) {
        return number.toString().length < 2 ? "0" + number : number;
      }
      //requestAnimationFrame(animate);
    };
    script.src = visualSource;

    document.head.appendChild(script); //or something of the likes
  }

  loadVisuals(config.effect);

  function submitForm(event) {
    console.log(moment(calendarInput.value).toISOString());
    var config = {
      title: title.textContent,
      subtitle: subtitle.textContent,
      time: moment(calendarInput.value).toISOString(),
      effect: effect.value
    };
    localStorage.setItem('countdownConfig', JSON.stringify(config));
    window.location.replace("trailer.html");
    return false;
  }

  function loadNewVisuals() {
    loadVisuals(effect.value);
  }
</script>